this.Element&&function(t){t.matches=t.matches||t.matchesSelector||t.webkitMatchesSelector||t.msMatchesSelector||function(t){for(var e=this,n=(e.parentNode||e.document).querySelectorAll(t),a=-1;n[++a]&&n[a]!=e;);return!!n[a]}}(Element.prototype),this.Element&&function(t){t.closest=t.closest||function(t){for(var e=this;e.matches&&!e.matches(t);)e=e.parentNode;return e.matches?e:null}}(Element.prototype);var PlentyAmazonPay={debug:!0,payButtonCount:0,init:function(){PlentyAmazonPay.registerChangeActions(),PlentyAmazonPay.registerLoginButtons(),PlentyAmazonPay.registerCheckoutButtons(),PlentyAmazonPay.registerAddCartButtons()},initCheckout:function(t){console.log("initCheckout()"),PlentyAmazonPay.registerHiddenButton(t)},ajaxPost:function(t,e){for(var n=t.action,a=(new XMLHttpRequest,[]),o=t.querySelectorAll("input, select, textarea"),r=0;r<o.length;r++){var i=o[r];i.name&&i.value&&a.push(encodeURIComponent(i.name)+"="+encodeURIComponent(i.value))}a=a.join("&"),PlentyAmazonPay.ajaxPostData(n,a,e)},ajaxPostData:function(t,e,n){var a=new XMLHttpRequest;a.open("POST",t),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onload=n.bind(a),a.send(e)},registerChangeActions:function(){try{amazon.Pay.bindChangeAction("#amazon-pay-change-address",{amazonCheckoutSessionId:AmazonPayConfiguration.checkoutSessionId,changeAction:"changeAddress"})}catch(t){}try{amazon.Pay.bindChangeAction("#amazon-pay-change-payment",{amazonCheckoutSessionId:AmazonPayConfiguration.checkoutSessionId,changeAction:"changePayment"})}catch(t){}},registerCheckoutButtons:function(){try{for(var t=document.querySelectorAll(".amazon-pay-button"),e=0;e<t.length;e++){var n=t[e];if(!n.id){var a="amazon-pay-button-"+PlentyAmazonPay.payButtonCount++;n.id=a,amazon.Pay.renderButton("#"+a,{merchantId:AmazonPayConfiguration.merchantId,createCheckoutSession:{url:AmazonPayConfiguration.createCheckoutSessionUrl},sandbox:AmazonPayConfiguration.isSandbox,ledgerCurrency:AmazonPayConfiguration.ledgerCurrency,checkoutLanguage:AmazonPayConfiguration.language,productType:"PayAndShip",placement:"Cart",buttonColor:n.getAttribute("data-color")?n.getAttribute("data-color"):"Gold"})}}}catch(t){PlentyAmazonPay.debug&&console.warn(t)}},registerLoginButtons:function(){try{const e=document.body.classList.contains("page-login"),n=document.querySelectorAll(".amazon-login-button");for(let a=0;a<n.length;a++){let o=n[a];if(e)o.classList.add("amazon-pay-button");else if(!o.id){var t="amazon-login-button-"+PlentyAmazonPay.payButtonCount++;o.id=t,amazon.Pay.renderButton("#"+t,{merchantId:AmazonPayConfiguration.merchantId,sandbox:AmazonPayConfiguration.isSandbox,ledgerCurrency:AmazonPayConfiguration.ledgerCurrency,checkoutLanguage:AmazonPayConfiguration.language,productType:"SignIn",placement:"Cart",buttonColor:o.getAttribute("data-color")?o.getAttribute("data-color"):"Gold",signInConfig:{payloadJSON:AmazonPayConfiguration.loginPayload,signature:AmazonPayConfiguration.loginSignature,publicKeyId:AmazonPayConfiguration.publicKeyId}})}}}catch(t){PlentyAmazonPay.debug&&console.warn(t)}},registerHiddenButton:function(t){try{const e=amazon.Pay.renderButton("#amazon-pay-button-hidden",{merchantId:AmazonPayConfiguration.merchantId,sandbox:AmazonPayConfiguration.isSandbox,ledgerCurrency:AmazonPayConfiguration.ledgerCurrency,checkoutLanguage:AmazonPayConfiguration.language,productType:"PayAndShip",placement:"Checkout"});e.initCheckout({createCheckoutSessionConfig:t})}catch(t){PlentyAmazonPay.debug&&console.warn(t)}},registerAddCartButtons:function(){for(var t=document.querySelectorAll(".amazon-add-cart-button"),e=0;e<t.length;e++){var n=t[e];try{if(!n.id){var a="amazon-add-cart-button-"+PlentyAmazonPay.payButtonCount++;n.id=a;var o=amazon.Pay.renderButton("#"+a,{merchantId:AmazonPayConfiguration.merchantId,sandbox:AmazonPayConfiguration.isSandbox,ledgerCurrency:AmazonPayConfiguration.ledgerCurrency,checkoutLanguage:AmazonPayConfiguration.language,productType:"PayAndShip",placement:"Product",buttonColor:n.getAttribute("data-color")?n.getAttribute("data-color"):"Gold"});o.onClick(function(){PlentyAmazonPay.buyProduct(function(){o.initCheckout({createCheckoutSession:{url:AmazonPayConfiguration.createCheckoutSessionUrl}})})})}}catch(t){PlentyAmazonPay.debug&&console.warn(t)}}},buyProduct:function(t){var e=null,n=1;if(void 0!==window.ceresStore.state.item&&window.ceresStore.state.item.variation.documents[0]?(e=window.ceresStore.state.item.variation.documents[0].data.variation.id,n=parseInt(window.ceresStore.state.item.variationOrderQuantity)):void 0!==window.ceresStore.state.items.mainItemId&&window.ceresStore.state.items[window.ceresStore.state.items.mainItemId]&&(e=window.ceresStore.state.items[window.ceresStore.state.items.mainItemId].variation.documents[0].data.variation.id,n=parseInt(window.ceresStore.state.items[window.ceresStore.state.items.mainItemId].variationOrderQuantity)),e){var a="variationId="+e+"&quantity="+n;PlentyAmazonPay.ajaxPostData("/rest/io/basket/items/",a,function(){t()})}else t()}};setInterval(PlentyAmazonPay.init,1e3),"undefined"!=typeof jQuery&&jQuery(function(){jQuery("[id^='reinitPaymentMethod-']").click(function(){const t=$(this).attr("id").split("-")[1];window.location="/payment/amazon-pay-existing-order?orderId="+t})}),document.addEventListener("historyPaymentMethodChanged",t=>{for(let e in t.detail.newOrder.order.properties)console.log("payment method changed event",t),3===t.detail.newOrder.order.properties[e].typeId&&(t.detail.newOrder.order.properties[e].value==AmazonPayConfiguration.paymentMethodId?document.getElementById("reinitPaymentMethod-"+t.detail.oldOrder.order.id).style.display="block":document.getElementById("reinitPaymentMethod-"+t.detail.oldOrder.order.id).style.display="none")});